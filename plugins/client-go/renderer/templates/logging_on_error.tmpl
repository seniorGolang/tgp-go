package main

import (
    "context"
    "log/slog"
    "os"
    "{{.PkgPath}}"
)

func main() {
    // Настраиваем slog handler только для ошибок
    handler := slog.NewJSONHandler(os.Stdout, &slog.HandlerOptions{
        Level: slog.LevelError, // Только ошибки
    })
    logger := slog.New(handler)
    slog.SetDefault(logger)
    
    // Инициализируем клиент с логированием только при ошибках
    client := {{.PkgName}}.New("http://localhost:9000",
        {{.PkgName}}.LogOnError(),
    )
    
    // Создаем контекст с дополнительными полями
    ctx := context.Background()
    ctx = slog.With("request_id", "req-12345", "user_id", "user-67890").WithContext(ctx)
    
    // Использование клиента
    // Логи будут выводиться только при ошибках
    {{.ServiceVar}} := client.{{.ContractName}}()
    {{.ResultVar}}, err := {{.MethodCall}}
    if err != nil {
        // Клиент автоматически залогирует ошибку с контекстом и дополнительными полями
        return
    }
    // При успешном выполнении логи не выводятся
    slog.InfoContext(ctx, "Request completed successfully",
        slog.String("service", "{{.ContractName}}"),
        slog.String("method", "{{.MethodName}}"),
    )
}

