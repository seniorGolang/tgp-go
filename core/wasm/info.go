//go:build wasip1

// GENERATED BY 'T'ool 'G'ateway. DO NOT EDIT.

package wasm

import (
	"fmt"

	"github.com/goccy/go-json"

	"tgp/core/i18n"
)

// infoHandler обрабатывает запрос на получение информации о плагине.
func infoHandler() (resp infoResponse, err error) {

	// pluginInstance объявлен в execute.go
	if pluginInstance == nil {
		return infoResponse{}, fmt.Errorf(i18n.Msg("plugin instance not set"))
	}

	info, err := pluginInstance.Info()
	if err != nil {
		return infoResponse{}, err
	}

	// Сериализуем plugin.Info в JSON
	infoBytes, err := json.Marshal(info)
	if err != nil {
		return infoResponse{}, fmt.Errorf(i18n.Msg("failed to marshal info")+": %w", err)
	}

	resp.Info = json.RawMessage(infoBytes)
	return resp, nil
}

// InfoExported обертка для экспорта функции info через WASM.
//
//go:wasmexport info
func InfoExported(ptr uint32, size uint32) (result uint64) {

	return exportWrapperSimple(infoHandler)(ptr, size)
}
