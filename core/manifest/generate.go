// GENERATED BY 'T'ool 'G'ateway. DO NOT EDIT.
package manifest

import (
	"fmt"
	"os"

	"github.com/goccy/go-json"

	"tgp/core/i18n"
	"tgp/core/plugin"
)

// GenerateManifest генерирует plugin.json файл из plugin.Info.
func GenerateManifest(pluginInstance plugin.Plugin, outputPath string) (err error) {

	var info plugin.Info
	if info, err = pluginInstance.Info(); err != nil {
		return fmt.Errorf(i18n.Msg("failed to get plugin info")+": %w", err)
	}
	manifest := Manifest{
		Name:         info.Name,
		Description:  info.Description,
		Author:       info.Author,
		License:      info.License,
		Dependencies: info.Dependencies,
	}
	var manifestJSON []byte
	if manifestJSON, err = json.MarshalIndent(manifest, "", "  "); err != nil {
		return fmt.Errorf(i18n.Msg("failed to marshal manifest")+": %w", err)
	}
	manifestJSON = append(manifestJSON, '\n')
	if err = os.WriteFile(outputPath, manifestJSON, 0600); err != nil {
		return fmt.Errorf(i18n.Msg("failed to write manifest file")+": %w", err)
	}
	return
}
