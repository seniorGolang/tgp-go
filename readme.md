# Плагины для генерации кода

Репозиторий содержит набор плагинов для системы [`tg`](https://github.com/seniorGolang/tg/v3) (Tool Gateway), предназначенных для автоматической генерации кода на основе Go интерфейсов с аннотациями `@tg`.

## О проекте

Проект предоставляет инструменты для создания полноценных серверных и клиентских приложений из описания контрактов в виде Go интерфейсов. Система использует аннотации `@tg` для настройки генерации и поддерживает два протокола: HTTP REST API и JSON-RPC 2.0.

Все плагины работают на основе единой модели проекта, создаваемой плагином `astg`, что обеспечивает согласованность между генерируемыми компонентами.

Для работы с плагинами требуется установленная платформа [`tg`](https://github.com/seniorGolang/tg/v3):

```bash
go install github.com/seniorGolang/tg/v3/cmd/tg@latest
```

### Дополнительная документация

- [Архитектура интеграции с Kafka, Redpanda и NATS](MESSAGING_ARCHITECTURE.md) — целевая архитектура плагина messaging: контракты consumer/producer, примеры объявления и использования, батчинг и эффективность.

## Аннотации

Все плагины работают на основе аннотаций `@tg`, которые указываются в комментариях Go кода. Аннотации могут применяться на разных уровнях:

- **Пакет** - действует на все интерфейсы и методы в пакете
- **Интерфейс** - действует на все методы интерфейса
- **Метод** - действует только на конкретный метод
- **Поле/Тип** - применяется к полям структур или параметрам методов

Приоритет аннотаций: Метод > Интерфейс > Пакет

Полный список поддерживаемых аннотаций и их описание доступны в документации плагина `astg` (команда `tg plugin doc astg`).

## Плагины

### ASTG - Парсер проекта

Плагин `astg` является основой всей системы генерации. Он анализирует Go код проекта, извлекает информацию о контрактах (интерфейсах с аннотациями `@tg`), типах данных, методах и аннотациях, создавая структурированную модель проекта.

**Основные возможности:**

- Автоматическое обнаружение интерфейсов с аннотациями `@tg`
- Парсинг и структурирование аннотаций на всех уровнях (пакет, интерфейс, метод, поле)
- Извлечение информации о типах данных и их зависимостях
- Разрешение типов из импортированных пакетов
- Создание единой модели проекта для использования другими плагинами

Подробная документация доступна через команду `tg plugin doc astg`.

### Server - Генератор серверного кода

Плагин `server` генерирует полный серверный код на основе фреймворка [Fiber](https://github.com/gofiber/fiber) с поддержкой HTTP REST API и JSON-RPC 2.0 протоколов.

**Основные возможности:**

- Автоматическая генерация HTTP endpoints на основе аннотаций
- Полная поддержка JSON-RPC 2.0 с batch запросами
- Встроенные middleware для логирования, метрик и трассировки
- Типобезопасные обработчики
- Единообразная обработка ошибок
- Поддержка параметров пути, query параметров, заголовков и cookies

**Команда:** `tg server --out <директория>`

Подробная документация доступна через команду `tg plugin doc server`.

### Client-Go - Генератор Go клиента

Плагин `client-go` генерирует типобезопасный Go клиент для взаимодействия с серверами, реализующими контракты с аннотациями `@tg`.

**Основные возможности:**

- Поддержка JSON-RPC 2.0 и HTTP REST API протоколов
- Типобезопасные методы на основе Go интерфейсов
- Поддержка batch запросов для JSON-RPC
- Опциональное логирование запросов и ответов
- Опциональный сбор метрик
- Гибкая настройка через опции клиента
- Автоматическая генерация документации

**Команда:** `tg client go --out <директория>`

Подробная документация доступна через команду `tg plugin doc client-go`.

### Client-TS - Генератор TypeScript клиента

Плагин `client-ts` генерирует типобезопасный TypeScript клиент для использования в веб-приложениях и Node.js приложениях.

**Основные возможности:**

- Полная поддержка TypeScript типов и интерфейсов
- Поддержка JSON-RPC 2.0 и HTTP REST API протоколов
- Асинхронные методы, возвращающие Promise
- Поддержка batch запросов
- Готовый к публикации NPM пакет
- Настройка через аннотации (npmName, npmRegistry, npmPrivate и др.)
- Автоматическая генерация документации с примерами

**Команда:** `tg client ts --out <директория>`

Подробная документация доступна через команду `tg plugin doc client-ts`.

### Swagger - Генератор OpenAPI документации

Плагин `swagger` генерирует OpenAPI 3.0 документацию для всех контрактов с аннотациями `@tg`.

**Основные возможности:**

- Полная поддержка спецификации OpenAPI 3.0
- Автоматическая генерация документации для HTTP и JSON-RPC endpoints
- Генерация схем данных для всех типов
- Документация параметров, заголовков, cookies
- Поддержка примеров запросов и ответов
- Схемы авторизации (Bearer token и др.)
- Группировка endpoints по тегам
- Экспорт в JSON и YAML форматы
- Встроенный HTTP сервер для просмотра документации (Swagger UI)

**Примеры использования:**

```bash
# Генерация документации в файл
tg swagger --out docs/openapi.yaml

# Запуск HTTP сервера для просмотра документации
tg swagger --serve :3000
```

Подробная документация доступна через команду `tg plugin doc swagger`.

## Установка плагинов

Плагины устанавливаются через систему управления пакетами платформы `tg`.

### Установка всех плагинов

Для интерактивной установки всех плагинов используйте:

```bash
tg pkg add https://github.com/seniorGolang/tgp-go
```

### Установка конкретного плагина

Для установки конкретного плагина укажите его имя после двоеточия:

```bash
tg pkg add https://github.com/seniorGolang/tgp-go:server
tg pkg add https://github.com/seniorGolang/tgp-go:swagger
tg pkg add https://github.com/seniorGolang/tgp-go:client-go
tg pkg add https://github.com/seniorGolang/tgp-go:client-ts
```

**Примечание:** Плагин `astg` устанавливается автоматически как зависимость при установке других плагинов, поэтому его не нужно устанавливать отдельно.

### Установка конкретной версии

По умолчанию устанавливается последняя актуальная версия плагина. Для установки конкретной версии укажите её в команде:

```bash
tg pkg add https://github.com/seniorGolang/tgp-go:client-go@1.0.0
```

## Использование плагинов

### Просмотр документации

Для получения подробной документации по любому плагину используйте команду:

```bash
tg plugin doc <имя-плагина>
```

Например:

- `tg plugin doc astg` - документация по парсеру и аннотациям
- `tg plugin doc server` - документация по генератору сервера
- `tg plugin doc client-go` - документация по генератору Go клиента
- `tg plugin doc client-ts` - документация по генератору TypeScript клиента
- `tg plugin doc swagger` - документация по генератору OpenAPI документации

## Создание нового плагина

Система предоставляет команду `tg plugin init` для создания нового плагина. Команда автоматически создает необходимую структуру плагина и конфигурационные файлы.

При создании первого плагина в репозитории также генерируется общий код для плагинов и конфигурация CI/CD.

**Пример использования:**

```bash
tg plugin init --name my-plugin --deploy-type github
```

### Использование astg как зависимости

При создании собственного плагина для генерации кода на основе модели проекта можно указать `astg` как зависимость. Это позволит автоматически загружать нужную версию при установке вашего плагина.

Зависимость указывается в методе `Info()` плагина в поле `Dependencies`:

```go
func (p *MyPlugin) Info() (info plugin.Info, err error) {
    info = plugin.Info{
        Name: "my-plugin",
        Dependencies: []string{
            "https://github.com/seniorGolang/tgp-go:astg@^1.0.0",
        },
        // ...
    }
    return
}
```

### Управление версиями и совместимостью

Зависимости можно указывать в нескольких форматах:

**Зависимость из того же репозитория:**

- `package` - любая версия
- `package@1.0.0` - конкретная версия
- `package@^1.0.0` - совместимая версия (>= 1.0.0, < 2.0.0)
- `package@~1.2.0` - приблизительно совместимая версия (>= 1.2.0, < 1.3.0)
- `package@>=1.0.0` - минимальная версия

**Зависимость из другого репозитория:**

- `https://github.com/seniorGolang/tgp-go:astg` - любая версия
- `https://github.com/seniorGolang/tgp-go:astg@^1.0.0` - совместимая версия
- `https://github.com/seniorGolang/tgp-go:astg@1.2.3` - конкретная версия

**Примеры:**

```go
Dependencies: []string{
    // Зависимость из того же репозитория без версии
    "astg",

    // Зависимость из того же репозитория с версией
    "astg@^1.0.0",

    // Зависимость из другого репозитория
    "https://github.com/seniorGolang/tgp-go:astg",

    // Зависимость из другого репозитория с ограничением версии
    "https://github.com/seniorGolang/tgp-go:astg@^1.0.0",
}
```

**Рекомендации по версиям:**

- Используйте `^1.0.0` для указания совместимости с мажорной версией (рекомендуется)
- Используйте `~1.2.0` для более строгого контроля минорных версий
- Используйте конкретную версию `1.2.3` только при необходимости точного соответствия
- Без указания версии плагин будет работать с любой версией зависимости (не рекомендуется для production)

## Лицензия

Проект распространяется под лицензией MIT. Подробности в файле [LICENSE](LICENSE).

## Автор

AlexK (seniorGolang@gmail.com)
